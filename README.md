# Проект: Telegram-бот и веб-чат с AI и интеграцией Bitrix24

Проект состоит из двух взаимосвязанных частей:

1. **Telegram-бот**  
   Реализован на Python (telegram). Бот проводит динамическое анкетирование, ведёт диалог с пользователем с помощью OpenAI (GPT-4) и интегрируется с CRM Bitrix24 (создаёт и обновляет сделки).

2. **Веб-чат**  
   Реализован на Node.js (Express, Socket.io). Чат захватывает контактные данные пользователя, проводит динамическое анкетирование, ведёт AI-диалог с использованием GPT-4 и интегрируется с Bitrix24.

---

## Структура проекта

```
.
├── telegram_bot
│   ├── bot.py
│   ├── requirements.txt
│   ├── Dockerfile
│   └── .env.example
└── web_chat
    ├── server.js
    ├── package.json
    ├── Dockerfile
    ├── .env.example
    └── public
        └── index.html
```

---

## Часть 1. Telegram-бот

### Настройка

1. **Клонируйте репозиторий** и перейдите в папку `telegram_bot`.

2. **Создайте файл `.env`**  
   На основе файла `.env.example` заполните переменные:
   - `TELEGRAM_BOT_TOKEN` — токен вашего Telegram-бота.
   - `OPENAI_API_KEY` — API-ключ OpenAI (GPT-4).
   - `BITRIX24_WEBHOOK` — URL вебхука для Bitrix24.
   - `DATABASE_URL` — строка подключения к PostgreSQL (например, `postgresql://user:password@host:port/database`).

3. **Установка зависимостей:**

   ```bash
   pip install -r requirements.txt
   ```

4. **Настройка базы данных:**  
   Создайте таблицу для хранения данных анкеты. Например:

   ```sql
   CREATE TABLE questionnaire (
       id SERIAL PRIMARY KEY,
       user_id BIGINT,
       question TEXT,
       answer TEXT,
       created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
   );
   ```

### Запуск

- **Локальный запуск:**

  ```bash
  python bot.py
  ```

- **Запуск через Docker:**

  ```bash
  docker build -t telegram_bot .
  docker run --env-file .env telegram_bot
  ```

---

## Часть 2. Веб-чат

### Настройка

1. Перейдите в папку `web_chat` и создайте файл `.env` на основе `.env.example`. Заполните следующие переменные:
   - `PORT` — порт сервера (по умолчанию 3000).
   - `OPENAI_API_KEY` — API-ключ OpenAI (GPT-4).
   - `BITRIX24_WEBHOOK` — URL вебхука для Bitrix24.
   - `DATABASE_URL` (при необходимости) — строка подключения к PostgreSQL.

2. **Установка зависимостей:**

   ```bash
   npm install
   ```

### Запуск

- **Локальный запуск:**

  ```bash
  npm start
  ```

- **Запуск через Docker:**

  ```bash
  docker build -t web_chat .
  docker run --env-file .env -p 3000:3000 web_chat
  ```

---

## Функционал

### Telegram-бот

- **Приветствие и сегментация:**  
  Бот предлагает выбрать категорию (например, "Компания" или "Частное лицо").

- **Анкетирование:**  
  Бот задаёт динамические вопросы, ответы сохраняются в PostgreSQL.

- **AI-диалог:**  
  После анкеты бот ведёт диалог с пользователем через GPT-4.

- **Интеграция с Bitrix24:**  
  Автоматически создаёт и обновляет сделки в CRM.

- **Inline-кнопки:**  
  После AI-диалога доступны кнопки: «Связаться с менеджером», «Перейти к оплате», «Дополнительный вопрос».

### Веб-чат

- **Захват контактных данных:**  
  Пользователь вводит имя, email и телефон при подключении.

- **Анкетирование:**  
  Аналогичный процесс динамического опроса, как у Telegram-бота.

- **AI-диалог:**  
  GPT-4 взаимодействует с пользователем.

- **Интеграция с Bitrix24:**  
  Создание и обновление сделок в CRM.

- **Подключение менеджера:**  
  Возможность подключения менеджера в чат.

---

## Технологии

### Telegram-бот:
- **Язык:** Python
- **Фреймворк:** telegram
- **База данных:** PostgreSQL
- **AI:** OpenAI API (GPT-4)
- **CRM:** Bitrix24 REST API
- **Деплой:** Docker

### Веб-чат:
- **Язык:** JavaScript (Node.js)
- **Фреймворк:** Express, Socket.io
- **База данных:** PostgreSQL (при необходимости)
- **AI:** OpenAI API (GPT-4)
- **CRM:** Bitrix24 REST API
- **Деплой:** Docker, AWS или Vercel

---

## Дополнительные примечания

- **Документация кода:**  
  В исходном коде подробно описаны основные этапы работы.

- **Безопасность:**  
  Чувствительные данные (токены, ключи) передаются через `.env`.

- **Расширение функционала:**  
  Для production-решения можно улучшить управление состояниями (FSM), обработку ошибок и логирование.

